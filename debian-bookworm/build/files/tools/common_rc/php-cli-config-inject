#!/bin/sh -e

env_vars="$(printenv | grep "PHP_CLI_" || true)"

# If no environment variables are present - early quit
if [ -z "$env_vars" ]; then
        exit 0
fi

# Detect PHP version
php_version="$(ls -1 /etc/php | head -n 1)"

# Add PHP section
echo "[PHP]" >> /etc/php/$php_version/cli/conf.d/90-environment.ini
# If new section is needed, add them in format:
# PHP_CLImysqli_ and section and for loop logic

echo "Injecting php configuration into file:  /etc/php/$php_version/cli/conf.d/90-environment.ini"

for item in $env_vars; do
        echo "${item#PHP_CLI_}" | tee /etc/php/$php_version/cli/conf.d/90-environment.ini
done;
